<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DeepNet Social - AI Research Community</title>
  <style>
    :root {
      --primary-blue: #1877f2;
      --hover-blue: #166fe5;
      --primary-background: #18191a;
      --secondary-background: #242526;
      --tertiary-background: #3a3b3c;
      --hover-overlay: rgba(255, 255, 255, 0.08);
      --primary-text: #e4e6ea;
      --secondary-text: #b0b3b8;
      --border-color: #3e4042;
      --red: #e74c3c;
      --red-hover: #c0392b;
      --green: #42b72a;
      --card-border-radius: 8px;
      --button-border-radius: 6px;
      --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-family);
      background-color: var(--primary-background);
      color: var(--primary-text);
      line-height: 1.4;
      overflow-x: hidden;
    }

    /* --- Major UI Components --- */
    .header {
      background-color: var(--secondary-background);
      border-bottom: 1px solid var(--border-color);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      height: 60px;
    }
    .main-container {
      margin-top: 60px;
      display: flex;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      gap: 24px;
      padding: 24px 16px;
    }
    .left-sidebar, .right-sidebar {
      width: 280px;
      position: sticky;
      top: 84px;
      height: calc(100vh - 100px);
    }
    .main-feed { flex: 1; max-width: 580px; }
    .card {
      background-color: var(--secondary-background);
      border-radius: var(--card-border-radius);
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
    }
    .hidden { display: none !important; }

    /* --- Header Styles --- */
    .header-content { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 16px; height: 100%; }
    .logo { display: flex; align-items: center; gap: 8px; font-size: 24px; font-weight: bold; color: var(--primary-blue); text-decoration: none; }
    .search-input { width: 100%; background-color: var(--tertiary-background); border: none; border-radius: 50px; padding: 10px 16px; color: var(--primary-text); font-size: 15px; }
    .search-input::placeholder { color: var(--secondary-text); }
    .header-actions { display: flex; align-items: center; gap: 8px; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; object-fit: cover; border: 2px solid transparent; transition: border-color 0.2s; }
    .user-avatar:hover { border-color: var(--primary-blue); }

    /* --- Sidebar Styles --- */
    .sidebar-item { display: flex; align-items: center; padding: 10px 8px; border-radius: var(--button-border-radius); color: var(--primary-text); text-decoration: none; transition: background-color 0.2s; margin-bottom: 4px; font-weight: 500; }
    .sidebar-item:hover { background-color: var(--tertiary-background); }
    .sidebar-icon { font-size: 20px; margin-right: 16px; width: 36px; text-align: center; }

    /* --- Post Composer --- */
    .composer-header { display: flex; align-items: center; gap: 12px; }
    .composer-input { background-color: transparent; border: none; color: var(--primary-text); font-size: 18px; width: 100%; resize: none; font-family: inherit; padding: 12px; }
    .composer-input::placeholder { color: var(--secondary-text); }
    .composer-tools { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); }
    .post-btn { background-color: var(--primary-blue); color: white; border: none; border-radius: var(--button-border-radius); padding: 8px 24px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
    .post-btn:hover { background-color: var(--hover-blue); }
    .post-btn:disabled { background-color: #555; cursor: not-allowed; }

    /* --- Post Styles --- */
    .post-author-info { display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; }
    .post-author { font-weight: 600; }
    .post-time { color: var(--secondary-text); font-size: 13px; }
    .post-content { margin: 16px 0; font-size: 16px; word-wrap: break-word; }
    .post-image-container { margin: 16px -16px -16px -16px; }
    .post-image { max-width: 100%; display: block; }
    .post-stats { display: flex; justify-content: space-between; color: var(--secondary-text); font-size: 14px; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
    .post-actions { display: flex; justify-content: space-around; padding-top: 4px; }
    .post-action { display: flex; align-items: center; gap: 8px; padding: 10px; background: none; border: none; border-radius: var(--button-border-radius); color: var(--secondary-text); cursor: pointer; transition: background-color 0.2s; font-weight: 600; flex: 1; justify-content: center; }
    .post-action:hover { background-color: var(--hover-overlay); }
    .post-action.liked { color: var(--primary-blue); }
    .share-info { font-size: 14px; color: var(--secondary-text); margin-bottom: 12px; font-weight: 500; }

    /* --- Profile View --- */
    .profile-header { padding: 24px; border-bottom: 1px solid var(--border-color); }
    .profile-info { display: flex; align-items: center; gap: 24px; }
    .profile-avatar { width: 128px; height: 128px; border-radius: 50%; object-fit: cover; }
    .profile-name { font-size: 28px; font-weight: bold; }
    .profile-bio { color: var(--secondary-text); margin-top: 8px; }
    .profile-stats { display: flex; gap: 24px; margin-top: 16px; }
    .stat { font-size: 16px; } .stat strong { color: var(--primary-text); }
    .profile-actions { margin-top: 16px; }
    .follow-btn { background-color: var(--primary-blue); color: white; border: none; padding: 8px 16px; border-radius: var(--button-border-radius); cursor: pointer; font-weight: 600; }

    /* --- Login Modal --- */
    .login-modal { /* ... existing styles ... */ }
    /* ... other existing styles ... */
  </style>
</head>
<body>

  <div id="root">

    <div id="loginView">
      <div class="login-modal">
        <div class="login-content">
          <div class="login-header">
            <div class="login-logo">üß† DeepNet Social</div>
            <div class="login-subtitle">Connect with AI researchers worldwide</div>
          </div>
          <div class="auth-tabs">
            <button class="auth-tab active" id="loginTabBtn">Login</button>
            <button class="auth-tab" id="signupTabBtn">Sign Up</button>
          </div>
          <form id="loginForm" class="auth-form">
            <div class="form-group"><input type="email" class="form-input" name="email" placeholder="Email address" required></div>
            <div class="form-group"><input type="password" class="form-input" name="password" placeholder="Password" required></div>
            <button type="submit" class="auth-btn">Log In</button>
            <div id="loginMessage" class="auth-message"></div>
          </form>
          <form id="signupForm" class="auth-form hidden">
             <div class="form-group"><input type="text" class="form-input" name="displayName" placeholder="Full Name" required></div>
            <div class="form-group"><input type="email" class="form-input" name="email" placeholder="Email address" required></div>
            <div class="form-group"><input type="password" class="form-input" name="password" placeholder="Create password" minlength="6" required></div>
            <button type="submit" class="auth-btn">Sign Up</button>
            <div id="signupMessage" class="auth-message"></div>
          </form>
        </div>
      </div>
    </div>

    <div id="mainAppView" class="hidden">
      <header class="header">
        <div class="header-content">
          <a href="#" class="logo" onclick="showView('feed')"><span>üß†</span> DeepNet</a>
          <div class="search-bar" style="flex: 1; max-width: 320px; margin: 0 16px;"><input type="text" class="search-input" placeholder="Search DeepNet"></div>
          <div class="header-actions">
            <img id="headerUserAvatar" class="user-avatar" onclick="showProfile(auth.currentUser.uid)">
            <button class="logout-btn" onclick="signOut(auth)">Logout</button>
          </div>
        </div>
      </header>

      <div class="main-container">
        <aside class="left-sidebar">
          <a href="#" class="sidebar-item" onclick="showProfile(auth.currentUser.uid)">
             <div class="sidebar-icon">üë§</div>
            <span id="sidebarProfileName">Your Profile</span>
          </a>
          <a href="#" class="sidebar-item" onclick="showView('feed')">
            <div class="sidebar-icon">üè†</div>
            <span>Home Feed</span>
          </a>
          <a href="#" class="sidebar-item"><div class="sidebar-icon">üîî</div><span>Notifications</span></a>
          <a href="#" class="sidebar-item"><div class="sidebar-icon">üí¨</div><span>Messages</span></a>
          <a href="#" class="sidebar-item"><div class="sidebar-icon">üîñ</div><span>Saved</span></a>
        </aside>

        <main id="feedView" class="main-feed">
          <div class="card post-composer">
            <div class="composer-header">
              <img id="composerAvatar" class="user-avatar" style="width: 40px; height: 40px;">
              <textarea class="composer-input" id="postInput" placeholder="What's on your mind?" rows="2"></textarea>
            </div>
            <div class="composer-tools">
              <div></div>
              <button class="post-btn" id="postButton" onclick="createPost()">Post</button>
            </div>
          </div>
          <div id="postsContainer"></div>
        </main>

        <main id="profileView" class="main-feed hidden">
          </main>

        <aside class="right-sidebar">
           </aside>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script type="module">
    // --- Firebase SDK Imports ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendEmailVerification, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, getDoc, setDoc, deleteDoc, updateDoc, query, orderBy, onSnapshot, serverTimestamp, increment, getDocs, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // --- Firebase Initialization ---
    const firebaseConfig = { /* Your Firebase Config Here */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    window.auth = auth; // Make auth globally accessible for onclick events

    // --- UI Element References ---
    const loginView = document.getElementById('loginView');
    const mainAppView = document.getElementById('mainAppView');
    const feedView = document.getElementById('feedView');
    const profileView = document.getElementById('profileView');
    const notification = document.getElementById('notification');
    let postsListenerUnsubscribe = null;

    // --- View Management ---
    window.showView = (viewName) => {
      feedView.classList.toggle('hidden', viewName !== 'feed');
      profileView.classList.toggle('hidden', viewName !== 'profile');
    };

    // --- Utility Functions ---
    const showNotification = (message, type = 'success') => { /* ... */ };
    const formatTime = (timestamp) => { /* ... */ };

    // --- Main App Logic: Profiles ---
    window.showProfile = async (userId) => {
      showView('profile');
      profileView.innerHTML = `<div class="card">Loading profile...</div>`;

      try {
        const userRef = doc(db, 'users', userId);
        const userSnap = await getDoc(userRef);

        if (!userSnap.exists()) {
          profileView.innerHTML = `<div class="card">User not found.</div>`;
          return;
        }
        const userData = userSnap.data();

        // Fetch user's posts
        const postsQuery = query(collection(db, 'posts'), where("authorId", "==", userId), orderBy('createdAt', 'desc'));
        const postSnaps = await getDocs(postsQuery);
        const userPosts = postSnaps.docs.map(d => ({id: d.id, ...d.data()}));

        const isFollowing = false; // Placeholder for follow logic
        const isOwnProfile = auth.currentUser.uid === userId;
        
        profileView.innerHTML = `
          <div class="card profile-header">
            <div class="profile-info">
              <img src="${userData.photoURL || `https://i.pravatar.cc/128?u=${userId}`}" class="profile-avatar">
              <div>
                <h2 class="profile-name">${userData.displayName}</h2>
                <p class="profile-bio">${userData.bio || 'AI Researcher & Enthusiast'}</p>
                <div class="profile-stats">
                  <span class="stat"><strong>${userPosts.length}</strong> posts</span>
                  <span class="stat"><strong>${userData.followersCount || 0}</strong> followers</span>
                  <span class="stat"><strong>${userData.followingCount || 0}</strong> following</span>
                </div>
                <div class="profile-actions">
                  ${!isOwnProfile ? `<button class="follow-btn" onclick="toggleFollow('${userId}')">${isFollowing ? 'Unfollow' : 'Follow'}</button>` : ''}
                </div>
              </div>
            </div>
          </div>
          <div id="profilePostsContainer"></div>
        `;

        const profilePostsContainer = document.getElementById('profilePostsContainer');
        userPosts.forEach(post => profilePostsContainer.appendChild(createPostElement(post)));

      } catch (error) {
        console.error("Error loading profile:", error);
        profileView.innerHTML = `<div class="card">Could not load profile.</div>`;
      }
    };
    
    window.toggleFollow = async (targetUserId) => {
        // This is a simplified version. A real implementation would check if already following.
        const currentUserRef = doc(db, "users", auth.currentUser.uid);
        const targetUserRef = doc(db, "users", targetUserId);

        // In a real app, you'd use a transaction to do this safely.
        await updateDoc(currentUserRef, { followingCount: increment(1) });
        await updateDoc(targetUserRef, { followersCount: increment(1) });

        showNotification(`You are now following this user!`);
        showProfile(targetUserId); // Refresh profile view
    };


    // --- Main App Logic: Posts & Feed ---
    const createPostElement = (postData) => { /* ... same as before ... */ };
    const listenForPosts = () => { /* ... same as before ... */ };

    // ... All other window functions like createPost, sharePost, toggleLike, etc. ...
    // Note: They need to be attached to window to be accessible from HTML onclick
    // window.createPost = async () => { ... };
    
    // --- Authentication ---
    onAuthStateChanged(auth, user => {
      if (user && user.emailVerified) {
        mainAppView.classList.remove('hidden');
        loginView.classList.add('hidden');
        // Update common UI elements
        document.getElementById('headerUserAvatar').src = user.photoURL || `https://i.pravatar.cc/40?u=${user.uid}`;
        document.getElementById('composerAvatar').src = user.photoURL || `https://i.pravatar.cc/40?u=${user.uid}`;
        document.getElementById('sidebarProfileName').textContent = user.displayName;
        listenForPosts();
        showView('feed');
      } else {
        mainAppView.classList.add('hidden');
        loginView.classList.remove('hidden');
        if (postsListenerUnsubscribe) postsListenerUnsubscribe();
      }
    });

    // Signup Form Handler
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const displayName = e.target.displayName.value;
      const email = e.target.email.value;
      const password = e.target.password.value;
      const messageEl = document.getElementById('signupMessage');

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // 1. Update Firebase Auth profile
        await updateProfile(user, { displayName });
        
        // 2. Create user document in Firestore
        await setDoc(doc(db, "users", user.uid), {
          uid: user.uid,
          displayName: displayName,
          email: email,
          photoURL: `https://i.pravatar.cc/128?u=${user.uid}`,
          followersCount: 0,
          followingCount: 0,
          createdAt: serverTimestamp()
        });

        // 3. Send verification email
        await sendEmailVerification(user);
        await signOut(auth);
        
        messageEl.className = 'auth-message success';
        messageEl.textContent = '‚úÖ Account created! Check your inbox to verify your email.';

      } catch (error) {
        messageEl.className = 'auth-message error';
        messageEl.textContent = `‚ùå ${error.message}`;
      }
    });

    // Login Form Handler & Tab Switcher
    // ... same as before ...

  </script>
</body>
</html>
